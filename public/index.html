<!DOCTYPE html>
<html lang=en>
<head>
	<meta charset=utf-8>
	<meta name=viewport content='width=device-width,initial-scale=1'>

	<title>Efimera - JS Live Coding Environment</title>

	<link rel=icon type=image/png href=./favicon.png>
	<link rel=stylesheet href=./bundle.css>
  <script src="https://unpkg.com/uuid@latest/dist/umd/uuidv4.min.js"></script>
  <script defer type=module src=./bundle.js></script>
  <script type=module>
    let populateWindowNamespace = (module) => {
      for (let p in module) window[p] = module[p]
    }

    let ownNamespace = (namespace, d) => (module) =>
      window[namespace] = d ? module.default : module

    let populateOn = (namespace, d) =>
      namespace === null ?
        populateWindowNamespace
        : ownNamespace (namespace, d)

		window.pikaImport = (pkg, ns, d = false) =>
			import ('https://cdn.pika.dev/' + pkg)
				.then (populateOn (ns !== undefined ? ns : pkg, d))

		window.unpkgImport = (pkg, ns, d = false) =>
			import ('https://unpkg.com/' + pkg)
				.then (populateOn (ns !== undefined ? ns : pkg, d))

    window.skypackImport = (pkg, ns, d = false) =>
      import ('https://cdn.skypack.dev/' + pkg)
        .then (populateOn (ns !== undefined ? ns : pkg, d))

    window.npmImport = (pkg, ns) => {
      // By using null as namespace, all names
      // from package namespace will be populated into
      // window namespace.
      if (pkg === 'frmidi') {
        return unpkgImport ('frmidi', ns)
      } else if (pkg === 'ramda') {
        return skypackImport ('ramda', ns)
      } else if (pkg === 'hybrids') {
        return unpkgImport ('hybrids', ns)
      } else {
        return unpkgImport (pkg, ns)
      }
    }
	</script>
</head>
<body>
  <e-session></e-session>
</body>
</html>
