<!DOCTYPE html>
<html lang=en>
<head>
	<meta charset=utf-8>
	<meta name=viewport content='width=device-width,initial-scale=1'>

	<title>Efimera - JS Live Coding Environment</title>

	<link rel=icon type=image/png href=./favicon.png>
	<link rel=stylesheet href=./build/bundle.css>

	<script defer type=module src=./build/bundle.js></script>
  <script src=./libs/debug.js></script>
  <script>
    let options = {
      visible: true,
      keyAssign: {
        key: 113,
        ctrl: true
      },
      focusOnShow: false,
      autoPopup: {
        scriptError: true,
        loadError: true,
        error: true,
        fatal: true
      },
      lines: 25,
      bufSize: 300,
      width: 532,
      zoom: 1,
      position: 'se',
      adjX: 25,
      adjY: 10,
      fontSize: 12,
    //  fontFamily: 'monofur',  // LEDs are not shown with monofur
      opacity: 0.25,
      showLineNums: true,
      showTimeStamp: false,
      useClock: false,
      useClearButton: false,
      useSuspendLogButton: false,
      usePinButton: false,
      useWinCtrlButton: false,
      useStopwatch: false,
      useDeviceInfo: false,
      useLed: true,
      useTools: false,
      useMsgDisplay: false,
      useScreenMeasure: false,
      useSystemInfo: false,
      useHtmlSrc: false,
      useElementInfo: false,
      useJsEditor: false,
      useCommandLine: false,
      useLogFilter: false
    }

    dbg.init (options)

    //window.console.assert = (p, msg) => { if (!p) dbg.log.e (msg) }
    //window.console.clear = dbg.log.clear
    //// window.console.count = ...
    //// window.console.countReset = ...
    //window.console.debug = dbg.log.d
    //window.console.error = dbg.log.e
    //// window.console.group = ...
    //// window.console.groupCollapsed = ...
    //// window.console.groupEnd = ...
    //window.console.info = dbg.log.i
    //window.console.log = dbg.log
    //window.console.warn = dbg.log.w
  </script>
  <script>
		window.pikaImport = (pkg, ns, d = false) => {
			if (ns === undefined) ns = pkg;

			let p =
				import('https://cdn.pika.dev/' + pkg)
					.then(m => window[ns] = d ? m.default : m)

			return p
		}

		window.unpkgImport = (pkg, ns, d = false) => {
			if (ns === undefined) ns = pkg;

			let p = 
				import('https://unpkg.com/' + pkg)
					.then(m => window[ns] = d ? m.default : m)

			return p
		}
	</script>
	<script defer type=module src=./libs/midi-parser-js/src/main.js></script>
	<script defer type=module>
		// Make everything of rxjs, flyd, RMidi and of LinnStrument
		// directly accesible in global namespace
		for (let p in efimera.RMidi) 
			window[p] = efimera.RMidi[p]

		for (let p in efimera.RMidiClock) 
			window[p] = efimera.RMidiClock[p]

		for (let p in efimera.RMidiFile) 
			window[p] = efimera.RMidiFile[p]

		for (let p in efimera.LinnStrumentJS)
			window[p] = efimera.LinnStrumentJS[p]

		for (let p in efimera.RMusic) 
			window[p] = efimera.RMusic[p]

		for (let p in efimera.RMusic_Defs) 
			window[p] = efimera.RMusic_Defs[p]

		for (let p in efimera.ramda)
			window [p] = efimera.ramda [p]

    for (let p in efimera.hybrids)
      window [p] = efimera.hybrids [p]

		window.Tone = efimera.tone.default

		window.rx = efimera.rxjs
		window.rxo = efimera.rxjs_operators

		window.setGlobal = name => v => window[name] = v
	</script>
</head>
<body>
  <e-app></e-app>
</body>
</html>
